# 户外运动管理平台 Phase 2 (M3 - 线路库与GIS集成) 开发计划

**目标**: 实现GPX文件上传解析、地图轨迹展示、线路详情页。
**周期**: Week 5-6

---

## 1. 工作分解结构 (WBS)

### 1.1 数据库更新 (Database)
- [ ] **DB-04**: 更新 `Route` 表，添加 PostGIS 几何字段 (`geometry`) 用于存储轨迹。
- [ ] **DB-05**: 设计 `RoutePoint` 表 (可选，如果需要存储详细打点信息，或者直接存 GeoJSON)。
- [ ] **DB-06**: 迁移现有 Seed 数据以支持新的 GIS 结构。

### 1.2 后端开发 (Backend)
- [ ] **BE-05**: **GPX 解析服务**
    - [ ] 引入 `togeojson` 或 `gpx-parser` 库。
    - [ ] 实现 GPX 文件上传接口 (支持 Multipart)。
    - [ ] 解析 GPX 提取元数据 (距离、爬升、难度估算)。
    - [ ] 将轨迹转换为 GeoJSON/WKT 并存入 PostGIS。
- [ ] **BE-06**: **线路查询 API 增强**
    - [ ] `GET /routes/:id` 返回 GeoJSON 格式的轨迹数据。
    - [ ] `GET /routes` 支持基于地理位置的搜索 (Nearby)。
- [ ] **BE-07**: **地图静态图生成** (可选，用于列表页缩略图)。

### 1.3 前端开发 (Frontend)
- [ ] **FE-08**: **地图组件集成**
    - [ ] 引入 `react-leaflet` 或 腾讯地图/高德地图 小程序 SDK。
    - [ ] 封装通用 `<MapViewer />` 组件。
- [ ] **FE-09**: **线路详情页升级**
    - [ ] 展示交互式地图轨迹。
    - [ ] 展示海拔图表 (ECharts/Recharts)。
    - [ ] 关键路点 (POI) 标记。
- [ ] **FE-10**: **发布活动 - 线路选择增强**
    - [ ] 领队发布活动时，支持上传 GPX 文件或从线路库选择。
    - [ ] 地图预览确认。

### 1.4 测试 (QA)
- [ ] **TEST-03**: GPX 解析单元测试 (覆盖不同格式的 GPX)。
- [ ] **TEST-04**: 线路详情页地图加载性能测试。

---

## 2. 依赖检查
- [ ] 确认 PostGIS 扩展已在数据库中启用。
- [ ] 确认对象存储 (OSS) 配置用于存原始 GPX 文件。
- [ ] 确认小程序地图 API 权限 (腾讯地图 Key)。
